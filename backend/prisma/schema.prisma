generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

/// *
/// * ======================================================
/// * USER TABLE
/// * ======================================================
model User {
  user_id          Int                    @id @default(autoincrement())
  username         String                 @unique
  password         String
  email            String                 @unique
  role             String
  status           String                 @default("Active")
  created_at       DateTime               @default(now())
  feedbackMessages FeedbackMessage[]
  parent           Parent?
  surveyFeedbacks  ParentSurveyFeedback[]
  student          Student?
  teacher          Teacher?

  @@map("users")
}

/// *
/// * ======================================================
/// * CLASS TABLE
/// * ======================================================
model Class {
  class_id   Int       @id @default(autoincrement())
  class_name String
  section    String?
  exams      Exam[]
  students   Student[]
  subjects   Subject[]

  @@map("class")
}

/// *
/// * ======================================================
/// * PARENT TABLE
/// * ======================================================
model Parent {
  parent_id  Int       @id @default(autoincrement())
  user_id    Int       @unique
  first_name String?
  last_name  String?
  phone      String?
  address    String?
  user       User      @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  students   Student[]

  @@map("parent")
}

/// *
/// * ======================================================
/// * STUDENT TABLE
/// * ======================================================
model Student {
  student_id  Int          @id @default(autoincrement())
  user_id     Int          @unique
  parent_id   Int?
  first_name  String?
  last_name   String?
  dob         DateTime?
  gender      String?
  address     String?
  phone       String?
  class_id    Int?
  attendance  Attendance[]
  fees        Fee[]
  results     Result[]
  class       Class?       @relation(fields: [class_id], references: [class_id])
  parent      Parent?      @relation(fields: [parent_id], references: [parent_id])
  user        User         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)
  submissions Submission[]

  @@index([class_id], map: "student_class_id_fkey")
  @@index([parent_id], map: "student_parent_id_fkey")
  @@map("student")
}

/// *
/// * ======================================================
/// * TEACHER TABLE
/// * ======================================================
model Teacher {
  teacher_id  Int          @id @default(autoincrement())
  user_id     Int          @unique
  first_name  String?
  last_name   String?
  subject     String?
  phone       String?
  address     String?
  assignments Assignment[]
  exams       Exam[]
  materials   Material[]
  subjects    Subject[]
  user        User         @relation(fields: [user_id], references: [user_id], onDelete: Cascade)

  @@map("teacher")
}

/// *
/// * ======================================================
/// * SUBJECT TABLE
/// * ======================================================
model Subject {
  subject_id  Int          @id @default(autoincrement())
  name        String
  description String?
  class_id    Int
  teacher_id  Int?
  assignments Assignment[]
  exams       Exam[]
  materials   Material[]
  class       Class        @relation(fields: [class_id], references: [class_id], onDelete: Cascade)
  teacher     Teacher?     @relation(fields: [teacher_id], references: [teacher_id])

  @@index([class_id], map: "subject_class_id_fkey")
  @@index([teacher_id], map: "subject_teacher_id_fkey")
  @@map("subject")
}

/// *
/// * ======================================================
/// * STUDY MATERIAL TABLE
/// * ======================================================
model Material {
  material_id Int      @id @default(autoincrement())
  subject_id  Int
  teacher_id  Int
  title       String
  file_url    String
  uploaded_at DateTime @default(now())
  subject     Subject  @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade)
  teacher     Teacher  @relation(fields: [teacher_id], references: [teacher_id], onDelete: Cascade)

  @@index([subject_id], map: "material_subject_id_fkey")
  @@index([teacher_id], map: "material_teacher_id_fkey")
  @@map("material")
}

/// *
/// * ======================================================
/// * ASSIGNMENT TABLE
/// * ======================================================
model Assignment {
  assignment_id Int          @id @default(autoincrement())
  subject_id    Int
  teacher_id    Int
  title         String
  instructions  String?
  due_date      DateTime
  created_at    DateTime     @default(now())
  subject       Subject      @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade)
  teacher       Teacher      @relation(fields: [teacher_id], references: [teacher_id], onDelete: Cascade)
  submissions   Submission[]

  @@index([subject_id], map: "assignment_subject_id_fkey")
  @@index([teacher_id], map: "assignment_teacher_id_fkey")
  @@map("assignment")
}

/// *
/// * ======================================================
/// * ASSIGNMENT SUBMISSION TABLE
/// * ======================================================
model Submission {
  submission_id Int        @id @default(autoincrement())
  assignment_id Int
  student_id    Int
  file_url      String
  submitted_at  DateTime   @default(now())
  marks         Int?
  feedback      String?
  assignment    Assignment @relation(fields: [assignment_id], references: [assignment_id], onDelete: Cascade)
  student       Student    @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@unique([assignment_id, student_id])
  @@index([student_id], map: "submission_student_id_fkey")
  @@map("submission")
}

/// *
model Exam {
  exam_id     Int        @id @default(autoincrement())
  subject_id  Int
  teacher_id  Int
  class_id    Int
  title       String
  exam_date   DateTime
  total_marks Int
  status      String     @default("Upcoming")
  /// NEW FIELD: which term this exam belongs to
  /// Allowed values in your system:
  /// "First Term Exam" | "Mid Term Exam" | "Final Term Exam"
  term        String     @default("First Term Exam")
  class       Class      @relation(fields: [class_id], references: [class_id], onDelete: Cascade)
  subject     Subject    @relation(fields: [subject_id], references: [subject_id], onDelete: Cascade)
  teacher     Teacher    @relation(fields: [teacher_id], references: [teacher_id], onDelete: Cascade)
  questions   Question[]
  results     Result[]

  @@index([class_id], map: "exam_class_id_fkey")
  @@index([subject_id], map: "exam_subject_id_fkey")
  @@index([teacher_id], map: "exam_teacher_id_fkey")
  @@map("exam")
}

/// *
/// * ======================================================
/// * QUESTION TABLE
/// * ======================================================
model Question {
  question_id    Int    @id @default(autoincrement())
  exam_id        Int
  question_text  String
  option_a       String
  option_b       String
  option_c       String
  option_d       String
  correct_option String
  exam           Exam   @relation(fields: [exam_id], references: [exam_id], onDelete: Cascade)

  @@index([exam_id], map: "question_exam_id_fkey")
  @@map("question")
}

/// *
/// * ======================================================
/// * RESULT TABLE
/// * ======================================================
model Result {
  result_id  Int     @id @default(autoincrement())
  exam_id    Int
  student_id Int
  marks      Int
  grade      String?
  gpa        Float?
  published  Boolean @default(false)
  exam       Exam    @relation(fields: [exam_id], references: [exam_id], onDelete: Cascade)
  student    Student @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@unique([exam_id, student_id])
  @@index([student_id], map: "result_student_id_fkey")
  @@map("result")
}

/// *
/// * ======================================================
/// * ATTENDANCE
/// * ======================================================
model Attendance {
  attendance_id Int      @id @default(autoincrement())
  student_id    Int
  date          DateTime
  status        String
  student       Student  @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@unique([student_id, date])
  @@map("attendance")
}

/// *
/// * ======================================================
/// * FEE
/// * ======================================================
model Fee {
  fee_id     Int       @id @default(autoincrement())
  student_id Int
  amount     Float
  status     String
  due_date   DateTime
  paid_at    DateTime?
  student    Student   @relation(fields: [student_id], references: [student_id], onDelete: Cascade)

  @@index([student_id], map: "fee_student_id_fkey")
  @@map("fee")
}

/// *
/// * ======================================================
/// * NOTICE
/// * ======================================================
model Notice {
  notice_id   Int       @id @default(autoincrement())
  title       String
  message     String
  /// Created timestamp
  created_at  DateTime  @default(now())
  /// Who should see this?
  /// "all" | "student" | "parent" | "teacher" | "class"
  target      String
  /// Optional: limit to a class (for class-based notices)
  class_id    Int?
  /// For old exam-based notices (if you still use them)
  exam_id     Int?
  /// Date that admin selects for the notice (e.g. event date)
  notice_date DateTime?
  /// "Active" / "Expired"
  status      String    @default("Active")

  @@map("notice")
}

/// *
/// * ======================================================
/// * FEEDBACK
/// * ======================================================
model FeedbackMessage {
  id          Int       @id @default(autoincrement())
  sender_id   Int
  child_label String?
  receiver    String
  subject     String
  message     String    @db.Text
  priority    String?   @default("Normal")
  send_copy   Boolean?  @default(false)
  created_at  DateTime? @default(now())
  sender      User      @relation(fields: [sender_id], references: [user_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_feedback_sender")

  @@index([sender_id], map: "fk_feedback_sender")
  @@map("feedback_messages")
}

model ParentSurveyFeedback {
  id                    Int       @id @default(autoincrement())
  parent_id             Int
  quality_education     Int?
  extracurricular       Int?
  teaching_methods      Int?
  campus_safety         Int?
  homework_load         String?
  teacher_attention     String?
  social_support        String?
  child_safety          String?
  extracurricular_level String?
  teaching_effective    String?
  suggestions           String?   @db.Text
  additional_feedback   String?   @db.Text
  created_at            DateTime? @default(now())
  parent                User      @relation(fields: [parent_id], references: [user_id], onDelete: Cascade, onUpdate: Restrict, map: "fk_survey_parent")

  @@index([parent_id], map: "fk_survey_parent")
  @@map("parent_survey_feedback")
}

model gradescale {
  id    Int    @id @default(autoincrement())
  min   Int
  max   Int
  grade String
  gpa   Float
}
